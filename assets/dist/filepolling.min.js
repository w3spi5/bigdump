(function(){"use strict";var C=document.getElementById("bigdump-config");if(!C)return;var B=JSON.parse(C.dataset.dbConfigured||"false"),M=JSON.parse(C.dataset.gzipSupported||"false"),G=4e3,p=null,g=new Set,f=new Set;function O(e){switch(e){case"SQL":return"bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200";case"GZip":return"bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-200";case"CSV":return"bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200";default:return"bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200"}}function Z(e){var t=e.split(".").pop().toLowerCase();return t==="sql"?"SQL":t==="gz"?"GZip":t==="csv"?"CSV":"SQL"}function R(){var e=document.getElementById("previewModal"),t=document.getElementById("historyModal");return e&&!e.classList.contains("hidden")||t&&!t.classList.contains("hidden")}function z(e){var t=document.getElementById("noFilesMessage"),r=document.getElementById("filesTableContainer");!t||!r||(e?(t.classList.remove("hidden"),r.classList.add("hidden")):(t.classList.add("hidden"),r.classList.remove("hidden")))}function T(e,t,r){var n=document.createElement("tr");n.className="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150",n.setAttribute("data-filename",e.name),t&&(n.classList.add("bg-green-50","dark:bg-green-900/20","animate-pulse"),setTimeout(function(){n.classList.remove("bg-green-50","dark:bg-green-900/20","animate-pulse")},3e3)),r&&n.classList.add("bg-amber-50","dark:bg-amber-900/20");var u=B&&(e.type!=="GZip"||M),a="px-4 py-3 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100",i=document.createElement("td");i.className=a;var l=document.createElement("strong");if(l.textContent=e.name,i.appendChild(l),r){var v=document.createElement("span");v.className="ml-2 text-amber-600 dark:text-amber-400 text-xs";var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttribute("class","icon w-4 h-4 fill-current inline-block animate-spin");var P=document.createElementNS("http://www.w3.org/2000/svg","use");P.setAttributeNS("http://www.w3.org/1999/xlink","href","assets/icons.svg#spinner"),x.appendChild(P),v.appendChild(x),v.appendChild(document.createTextNode(" Uploading...")),i.appendChild(v)}else if(t){var E=document.createElement("span");E.className="ml-2 px-1.5 py-0.5 bg-green-500 text-white text-xs rounded font-medium",E.textContent="NEW",i.appendChild(E)}n.appendChild(i);var y=document.createElement("td");y.className=a,y.textContent=r?"--":e.sizeFormatted,n.appendChild(y);var N=document.createElement("td");N.className=a,N.textContent=r?"--":e.date,n.appendChild(N);var F=document.createElement("td");F.className=a;var k=document.createElement("span");k.className="px-2 py-1 rounded text-xs font-medium "+O(e.type),k.textContent=e.type,F.appendChild(k),n.appendChild(F);var d=document.createElement("td");if(d.className=a+" text-center",r){var S=document.createElement("span");S.className="text-gray-400",S.textContent="--",d.appendChild(S)}else{if(u){var o=document.createElement("button");o.type="button",o.className="btn btn-icon btn-purple",o.title="Preview SQL content",o.onclick=function(){window.previewFile(e.name)};var L=document.createElementNS("http://www.w3.org/2000/svg","svg");L.setAttribute("class","icon w-4 h-4 fill-current");var A=document.createElementNS("http://www.w3.org/2000/svg","use");A.setAttributeNS("http://www.w3.org/1999/xlink","href","assets/icons.svg#eye"),L.appendChild(A),o.appendChild(L),d.appendChild(o),d.appendChild(document.createTextNode(" "));var s=document.createElement("form");s.method="post",s.action="",s.style.display="inline";var b=document.createElement("input");b.type="hidden",b.name="fn",b.value=e.name,s.appendChild(b);var w=document.createElement("button");w.type="submit",w.className="btn btn-green",w.textContent="Import",s.appendChild(w),d.appendChild(s),d.appendChild(document.createTextNode(" "))}else if(e.type==="GZip"){var D=document.createElement("span");D.className="text-muted",D.textContent="GZip not supported",d.appendChild(D),d.appendChild(document.createTextNode(" "))}var m=document.createElement("a");m.href="?delete="+encodeURIComponent(e.name),m.className="btn btn-red",m.textContent="Delete",m.onclick=function(){return confirm("Delete "+e.name+"?")},d.appendChild(m)}return n.appendChild(d),n}function Q(e,t){var r=document.getElementById("fileTableBody");if(r){var n=new Set(t.map(function(a){return a.name})),u=document.createDocumentFragment();f.forEach(function(a){if(!e.find(function(l){return l.name===a})){var i={name:a,type:Z(a),sizeFormatted:"--",date:"--"};u.appendChild(T(i,!1,!0))}}),e.forEach(function(a){var i=n.has(a.name),l=f.has(a.name);u.appendChild(T(a,i,l))}),r.replaceChildren(u)}}function U(){document.querySelectorAll("#fileTableBody tr[data-filename]").forEach(function(e){g.add(e.getAttribute("data-filename"))})}function h(){U(),p=setInterval(c,G)}function I(){p&&(clearInterval(p),p=null)}function c(){R()||fetch("files/list").then(function(e){return e.json()}).then(function(e){if(e.success){var t=new Set(e.files.map(function(n){return n.name})),r=e.files.filter(function(n){return!g.has(n.name)});Q(e.files,r),g=t,z(e.files.length===0)}}).catch(function(e){console.error("File polling error:",e)})}function V(e){f.add(e),c()}function _(e){f.delete(e),g.add(e),c()}document.addEventListener("visibilitychange",function(){document.hidden?I():h()}),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h(),window.BigDump=window.BigDump||{},window.BigDump.refreshFileList=c,window.BigDump.trackUploadStart=V,window.BigDump.trackUploadEnd=_,window.BigDump.startFilePolling=h,window.BigDump.stopFilePolling=I,window.refreshFileList=c})();
