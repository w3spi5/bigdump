(function(){"use strict";function s(){var e=document.getElementById("historyModal"),i=document.getElementById("historyLoading"),n=document.getElementById("historyContent");e.classList.remove("hidden"),i.classList.remove("hidden"),n.classList.add("hidden"),fetch("?action=history&limit=20").then(function(t){return t.json()}).then(function(t){if(i.classList.add("hidden"),!t.success){n.textContent="Error loading history",n.classList.remove("hidden");return}var d=t.statistics;document.getElementById("histStatTotal").textContent=d.total_imports,document.getElementById("histStatSuccess").textContent=d.successful_imports,document.getElementById("histStatFailed").textContent=d.failed_imports,document.getElementById("histStatQueries").textContent=d.total_queries.toLocaleString();var c=document.getElementById("historyTableBody");if(c.replaceChildren(),t.history.length===0){var b=document.createElement("tr"),a=document.createElement("td");a.colSpan=5,a.className="px-4 py-8 text-center text-gray-500 dark:text-gray-400",a.textContent="No import history yet",b.appendChild(a),c.appendChild(b)}else t.history.forEach(function(r){var o=document.createElement("tr");o.className="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150";var l=document.createElement("td");l.className="px-4 py-3 border-b border-gray-200 dark:border-gray-700 text-center";var v=r.success?"circle-check":"circle-xmark",C=r.success?"text-green-500":"text-red-500",m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttribute("class","icon w-5 h-5 fill-current inline-block "+C);var f=document.createElementNS("http://www.w3.org/2000/svg","use");f.setAttributeNS("http://www.w3.org/1999/xlink","href","assets/icons.svg#"+v),m.appendChild(f),l.appendChild(m);var u=document.createElement("td");u.className="px-4 py-3 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 font-medium",u.textContent=r.filename;var g=document.createElement("td");g.className="px-4 py-3 border-b border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 text-sm",g.textContent=r.datetime;var h=document.createElement("td");h.className="px-4 py-3 border-b border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 text-sm",h.textContent=r.queries_executed.toLocaleString()+" queries / "+r.size_formatted;var y=document.createElement("td");y.className="px-4 py-3 border-b border-gray-200 dark:border-gray-700";var p=document.createElement("span");p.className=r.success?"px-2 py-1 rounded text-xs font-medium bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200":"px-2 py-1 rounded text-xs font-medium bg-red-100 dark:bg-red-900/50 text-red-800 dark:text-red-200",p.textContent=r.success?"Success":"Failed",y.appendChild(p),o.appendChild(l),o.appendChild(u),o.appendChild(g),o.appendChild(h),o.appendChild(y),c.appendChild(o)});n.classList.remove("hidden")}).catch(function(t){i.classList.add("hidden"),n.textContent="Network error: "+t.message,n.classList.remove("hidden")})}function x(e){e&&e.target!==e.currentTarget||document.getElementById("historyModal").classList.add("hidden")}function w(){confirm("Are you sure you want to clear all import history?")&&fetch("?action=history&do=clear").then(function(e){return e.json()}).then(function(e){e.success&&s()})}window.BigDump=window.BigDump||{},window.BigDump.showHistory=s,window.BigDump.closeHistoryModal=x,window.BigDump.clearHistory=w,window.showHistory=s,window.closeHistoryModal=x,window.clearHistory=w})();
